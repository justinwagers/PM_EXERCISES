---
title: "Market Segmentation"
author: "Justin Wagers"
date: "8/9/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=5, fig.height=4) 
```

# Market Segmentation

  NutrientH20 has requested a market segment analysis on their social media audience. We are given 7,882 twitter followers along with the frequency with which they've tweeted about 36 different topics. 
  
  From a basic sweep over the various topics, one might assume that some are more correlated than others. For instance, those tweeting about Health and Nutrition are likely to be the same people tweeting about personal fitness. However, given the multitude of possible groupings of these topics, we will want to automate the process. For that, we conduct a k-means clustering analysis. While most of the topics are relevant, we have removed the "chatter" and "uncategorized" topics from our topic list as they appear to have been used by annotators to classify tweets that didn't fit into other categories. They likely represent a multitude of topics so we omit them to avoid the k-means model assuming that they represent one topic.  
  
  To choose the optimal number of clusters, we first look at the Gap Statistic for various values of k.  
  
```{r, include= FALSE}
#### Import Data
library(readr)
SM <- read_csv("social_marketing.csv")
SM$chatter <- NULL
SM$unknown <- NULL
rownames(SM) <- SM$X1
SM$X1 <- NULL
summary(SM)

# Center and scale the data
X = SM[,(1:34)]
X = scale(X, center=TRUE, scale=TRUE)
X = na.omit(X)

# Extract the centers and scales from the rescaled data 
mu = attr(X,"scaled:center")
sigma = attr(X,"scaled:scale")
```

```{r , echo=FALSE}
#Choose value of k
#WARNING: This takes a while
library(cluster)
SM_gap = clusGap(X, FUN = kmeans, nstart = 50, K.max = 10, B = 5)
plot(SM_gap, main = 'Gap Statistic vs. Number of Clusters')
```
  


From this gap statistic plot, we are not getting a clear definition of what number of clusters to choose, and the data is not converging cleanly before k =10. However, we do see a slight kink at both k=5 and k=7, and decide to choose 5 clusters to hopefully identify easily interpretable market segments within the NutrientH20 social media following.  

Now we can construct our k-means clustering with k=5 and 25 initial configurations. The k-means algorithm clusters by the following percentages (we will look at the characteristics of these clusters shortly):  


```{r , include = FALSE}
# Run k-means with 5 clusters and 25 starts
set.seed(23)
clust1 = kmeans(X, 5, nstart=25)

# What are the clusters?
clust1$center  # not super helpful
clust1$center[1,]*sigma + mu
clust1$center[2,]*sigma + mu
clust1$center[3,]*sigma + mu
clust1$center[4,]*sigma + mu
clust1$center[5,]*sigma + mu

# Which cars are in which clusters?
which(clust1$cluster == 1)
which(clust1$cluster == 2)
which(clust1$cluster == 3)
which(clust1$cluster == 4)
which(clust1$cluster == 5)

a = length(which(clust1$cluster ==1))/length(clust1$cluster)

b = length(which(clust1$cluster ==2))/length(clust1$cluster)

c = length(which(clust1$cluster ==3))/length(clust1$cluster)
d = length(which(clust1$cluster ==4))/length(clust1$cluster)

e = length(which(clust1$cluster ==5))/length(clust1$cluster)
```

Group 1 - 61.38% of twitter following  

Group 2 - 9.99% of twitter following  

Group 3 - 9.07% of twitter following  

Group 4 - 7.66% of twitter following  

Group 5 - 11.89% of twitter following  



After automating the market segment split via kmeans, we confirm our cluster choices by conducting a k-means++ initialization and comparing the centroids of our clusters from each initialization method.    

```{r, include = FALSE}
library(LICORS)
# Using kmeans++ initialization
clust2 = LICORS::kmeanspp(X, k=5, nstart=25)

clust2$center[1,]*sigma + mu
clust2$center[2,]*sigma + mu
clust2$center[4,]*sigma + mu

# Which cars are in which clusters?
which(clust2$cluster == 1)
which(clust2$cluster == 2)
which(clust2$cluster == 3)
```


```{r, include= FALSE}
# Compare versus within-cluster average distances from the first run
kmeans = clust1$withinss
kmeanspp = clust2$withinss
sum(clust1$withinss)
sum(clust2$withinss)
clust1$tot.withinss
clust2$tot.withinss
clust1$betweenss
clust2$betweenss
```

Within-cluster average distances for the first run are identical for k-means and k-means++ after 25 iterations.

Kmeans average distances:  
```{r, echo= FALSE}
sort(kmeans)
```
K-means++ average distances:  

```{r, echo= FALSE}
sort(kmeanspp)
```

We can see that from both k-means and k-means++ initialization, we receive identical groups for our 5 clusters. 

Having established five different market segments, we can explore the characteristics of each segment visually through a few topic comparison plots.   

```{r , echo=FALSE}
library(ggplot2)
# A few plots with cluster membership shown
# qplot is in the ggplot2 library
```


```{r , echo=FALSE}
qplot(health_nutrition, cooking, data=SM, color=factor(clust1$cluster), main = 'Interest in Health vs. Cooking for Different Market Segments')
```

Here we see an interesting split between clusters - although group 5 seems to care greatly about health and nutrition, they care less about cooking than does group 4. This gives us the inkling that group 5 might be our "fit" group.   

```{r , echo=FALSE}
qplot(health_nutrition, politics, data=SM, color=factor(clust1$cluster),main = 'Interest in Health vs. Politics for Different Market Segments')
```

Here we can see that group 3 concerns themselves with politics far more often than do the other twitter followers.   

```{r , echo=FALSE}
qplot(politics, parenting, data=SM, color=factor(clust1$cluster),main = 'Interest in Politics vs. Parenting for Different Market Segments')
```

Here we can see that group 2 is more concerned with parenting than any other group. This might be a more family-oriented audience.   

```{r , echo=FALSE}
qplot(online_gaming, outdoors, data=SM, color=factor(clust1$cluster),main = 'Interest in Online Gaming vs. The Outdoors for Different Market Segments')
```

Finally, here we again see that our "fit" group - group 5-  is the most interested in the outdoors, while group 1 stands out as having interests in online gaming.   

Thus, we can see some distinct characteristics about each cluster of NutrientH20 twitter followers. We can look at the top 5 defining topics for the centroids of each cluster to start to develop a better idea of who falls into each group. 

## "The General Public"

```{r,echo = FALSE}
listed = clust1$center[1,]*sigma + mu
head(sort(listed, decreasing = TRUE), n = 5)
```

Group 1 tends to share photos and post about online gaming, college, and shopping at higher rates than other groups. However, none of the topics stand out with a particularly high importance. It appears k-means has defined this cluster as a "catch-all" for individuals who don't fit the four molds described below. 

## "Family-Oriented

```{r,echo = FALSE}
listed = clust1$center[2,]*sigma + mu
head(sort(listed, decreasing = TRUE), n = 5)
```

Group 2 concerns themselves with sports fandom, religion, food and family topics. We might assume this to be middle-aged parents and a generally more family-oriented audience.   


## "Internationally Aware"
```{r,echo = FALSE}
listed = clust1$center[3,]*sigma + mu
head(sort(listed, decreasing = TRUE), n = 5)
```
Group 3 posts frequently about politics, news, and travel. These might be internationally inclined, exploratory individuals.


## "The Insta Girls"
```{r,echo = FALSE}
listed = clust1$center[4,]*sigma + mu
head(sort(listed, decreasing = TRUE), n = 5)
```

Group 4 tends to frequently share photos and concern themselves with cooking, fashion, and beauty.  


## "The Fit-Focused"
```{r,echo = FALSE}
listed = clust1$center[5,]*sigma + mu
head(sort(listed, decreasing = TRUE), n = 5)
```
Group 5 posts are very much focused on health, nutrition, fitness, and to a lesser extent the outdoors. This may very well be NutrientH20's target market.   
  

  
Given NutrientH20's branding, we might assume some interest in the seemingly health and fitness-focused market segment that is group 5. Below we have compiled the 937 "group 3" members that tend to be health, nutrition, and fitness inclined. We display the first five user codes as an example.

```{r, include = FALSE}
SM <- read_csv("social_marketing.csv")
indices = which(clust1$cluster == 5) 
FitFollowers <- SM[c(indices),]$X1
```


```{r, echo = FALSE}
head(FitFollowers)
# 870 fitness-interested followers
```
Without full information on its marketing strategy, we cannot be certain as to which consumers NutrientH20 wishes to target. However, we suspect that the "Fit-Focused" group, as characterized above by interests in health and personal fitness, might be the most receptive of Nutrient H20's marketing material. We should note that this demographic only makes up 12% of NutrientH20's Twitter following, and still might find value in marketing to "The General Public" (61% of following) or "The Insta Girls" (8% of following). 

We hope this has helped NutrientH20 identify its target market among its twitter followers and be able to target advertising to this group of customers more effectively. 
