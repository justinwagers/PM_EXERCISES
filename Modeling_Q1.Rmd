---
title: "Modeling Final, Q. 1"
output: pdf_document
---
###1

From the beginning, I'm suspicious of the excel guru's analysis because first, he cut out buildings that had less than 10% occupancy. This did not take into account the age of the building. If it was developed in the last six months or a year, this less than 10% rule should not be applicable to the building. Yes, there are cases where this less than 10% metric could be a telling factor of the quality of the building or administration, it should not be used as a blanket statement that <=10% occupancy is bad. Secondly, he just took an average of the rent of non-green buildings and green buildings to then forecast premium rent rates of green buildings. He completely disregarded the 21 other variables that could have been used. 

```{r setup, include=FALSE}
library(mosaic)
library(ggplot2)
library(tidyverse)
library(ggplot2)
library(pairwise)
buildings <- read.csv('https://raw.githubusercontent.com/jgscott/STA380/master/data/greenbuildings.csv')
attach(buildings)
buildings$green_rating = as.factor(buildings$green_rating)
```

```{r echo=FALSE}
#Plotting Rent as a function of Size
ggplot(buildings, aes(size, Rent)) +
  geom_point(aes(color = green_rating)) +
  geom_smooth(se = FALSE) +
  labs(x = 'Total Size in Sq. Ft.',
       y = 'Rent per Square Foot, per Year',
       colour = 'Green Rating (0 or 1)') + 
  scale_fill_manual(values = c('navyblue', 'green1')) + 
  ggtitle('Rent as a function of Size', 'Mean size = 234,637.74 sqft.\nGreen Buildings Mean Size = 325,781.32 sqft. \nNon-Green Buildings Mean Size = 225,977.27 sqft.')

mean_size = mean(size)
mean_green = mean(buildings$size[buildings$green_rating == 1])
mean_std = mean(buildings$size[buildings$green_rating == 0])
```
This initial plot shows how Rent changes as the total size of the building increases.While the fitted line is not a good predictor, we can see that the rent price does increase as size of the building increases.

Green buildings have a higher mean building size than standard ones, which can be a reason to believe that green buildings are able to fetch higher rent prices. 


###2
```{r echo=FALSE}
g = ggplot(buildings, aes(x=Rent))
g + geom_density(aes(fill=factor(green_rating)),alpha = 0.6) + labs(title='Standard vs Green Density') +
  scale_fill_manual(values = c('navyblue', 'green1')) + ggtitle('Standard vs Green Density', "Median Rent = $25.16/sqft./yr. \nGreen Buildings' Median Rent = $27.6/sqft./yr. \nStandard Buildings' Median Rent = $25/sqft./yr.")

median_overall = median(Rent)
median_green = median(buildings$Rent[buildings$green_rating == 1])
median_std = median(buildings$Rent[buildings$green_rating == 0])
```
Here we can see that while green buildings have a slightly higher median compared to standard buildings, they are practically identical. This slightly higher median rent could be attributed to the on average larger building size of the green buildings, but we must look into more variables to get a better idea.

###3
```{r echo=FALSE}
ggplot(buildings, aes(age, Rent)) +
  geom_point(aes(color = green_rating)) +
  geom_smooth(se = FALSE) +
  labs(x = 'Age (Years)',
       y = 'Rent per Square Foot, per Year',
       colour = 'Green Rating (0 or 1)') +
  scale_fill_manual(values = c('navyblue', 'green1')) + 
  ggtitle("Rent as a function of Age", "Average Age = 47.24 years\n Average Green Age = 23.85 years\n Average Standard Age = 49.47 years")

mean_age = mean(age)
green_age = mean(buildings$age[buildings$green_rating == 1])
standard_age = mean(buildings$age[buildings$green_rating == 0])
```
With age, we can see that there is a gradual decrease in rent as the building ages, but there are many outliers that charge very high rent rates. 

Since there is a negative correlation between age and rent prices, and green buildings have a much lower average age compared to the overall average, we inferred that this can leads to generally higher rent prices for green buildings. 

This factor coupled with their higher than average sizes supports the assumption that buildings with green status can charge a premium in rent.

###4
```{r echo=FALSE}
temp = buildings$class_a-buildings$class_b
buildings$class[temp == -1] = 'b'
buildings$class[temp == 0] = 'c'
buildings$class[temp == 1] = 'a'

ggplot(data=buildings, aes(x=class, y=Rent)) +
         geom_point(mapping=aes(x=class, y=Rent, colour=green_rating)) +
        geom_boxplot() + 
  labs(x='Class') + 
  scale_fill_manual(values = c('navyblue', 'green1')) + 
  ggtitle('Box plot for each class type', 'Avg. Price Class "A" = $32.32\nAvg. Price Class "B" = $26.39\nAvg. Price Class "C" = $23.94')
        
avg_price_a = mean(buildings$Rent[buildings$class == 'a'])
avg_price_b = mean(buildings$Rent[buildings$class == 'b'])
avg_price_c = mean(buildings$Rent[buildings$class == 'c'])
```
After seeing how Rent changes as a function of numeric variables age and size, we wanted to see how class affects rent. Of course, the highest class building, class A, has the highest median and range, followed by B then C.

###5
```{r echo=FALSE}
library(ggplot2)
building_a_count = sum(buildings$class =='a')
a_proportion = (building_a_count/nrow(buildings))*100
building_b_count = sum(buildings$class == 'b')
b_proportion = (building_b_count/nrow(buildings))*100
building_c_count = sum(buildings$class == 'c')
c_proportion = (building_c_count/nrow(buildings))*100

green_a_prop = (sum(buildings$class == 'a' & buildings$green_rating == 1)/sum(buildings$green_rating == 1))*100
green_b_prop = (sum(buildings$class == 'b' & buildings$green_rating == 1)/sum(buildings$green_rating == 1))*100
green_c_prop = (sum(buildings$class == 'c' & buildings$green_rating == 1)/sum(buildings$green_rating == 1))*100
green_a = sum(buildings$class == 'a' & buildings$green_rating == 1)
green_c = sum(buildings$class == 'c' & buildings$green_rating == 1)
green_b = sum(buildings$class == 'b' & buildings$green_rating == 1)
ggplot(buildings, aes(x=class, y=..count..)) + 
  geom_bar(aes(fill=green_rating)) +
  scale_fill_manual(values = c('navyblue', 'green1'), name='Standard vs. Green') + 
  labs(x='Class', y='Count') +
  ggtitle('Proportion of Green vs. Standard', 'Proportion of green buildings that are class A = 79.71% (546)\nProportion of green buildings that are class B = 19.27% (132)\nProportion of green buildings that are class C = 1.02% (7)')

```
Here we can see that out of the three classes, green has it's highest number in class A. As we saw above, class A is also the most expensive classification of building. Based on green buildings being nearly 80% class A, one can claim that there is a positive correlation between green status and higher rent prices; if someone were to randomly pick a green building, 4/5 times they would choose a class A, the highest price class.  

```{r echo=FALSE}
ggplot(buildings, aes(x=empl_gr, y=Rent)) + 
  geom_point(size=.5, aes(color=green_rating)) + 
  scale_fill_manual(values = c('navyblue', 'green1'), name='Standard vs. Green') + 
  ggtitle('Rent as a function of YoY Employment Growth Rate by Region') + 
  labs(x='YoY Employment Growth Rate', y='Rent', colour='Green Rating')
```
We were curious on how Rent prices fluctuated, given the year-over-year employment growth rate that each building's region was seeing. While there is a very slight increase in the range of rent prices from the subsets 15% to 60%, we decided that this data is inconclusive. The majority grouping of buildings in the 0-7.5% range has such a wide range of rent prices that it appears that growth rate does not affect rent prices charged. 



From the three variables tested that provided substantial evidence (Size, Age, and Class), they indirectly showed that people paid a premium for green buildings. While this does support the stats guru's conclusion that the company could price the rent of a green building at a premium, we do not believe that these conclusions provide enough evidence to concretely say that any green building can charge a premium. What we did conclude is that the company should focus more on is the overall size of the building and developing one that would be of class A. 

Size - Since buildings that are larger generally charge higher prices on average, the company should research developing a building larger than average (234,638 sqft.). 
Class - Buildings that are of class A, on average charge the highest rent prices at $32.32/sqft., while class B and class C charge $26.39/sqft.and $23.94/sqft., respectively. 

While we cannot say with certainty that a building that has a received a green rating equates to being able to charge a premium over non-green rated buildings, we do believe that a further in-depth analysis on other variables should be taken generate this answer. 